<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>å‰µæ„ç­‰ç´šæ¸¬é©—ï½œLv.0â€“Lv.7</title>
  <style>
    :root{
      --bg1:#0b1020;
      --bg2:#0a1a2f;
      --card:rgba(255,255,255,.08);
      --card2:rgba(255,255,255,.06);
      --stroke:rgba(255,255,255,.12);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.68);
      --brand:#7c5cff;
      --brand2:#38d9ff;
      --ok:#5cffb2;
      --warn:#ffcc66;
      --danger:#ff6b6b;
      --shadow: 0 16px 50px rgba(0,0,0,.45);
      --radius:22px;
      --radius2:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", Arial, sans-serif;
    }
    *{ box-sizing:border-box; }
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% 0%, rgba(124,92,255,.18), transparent 60%),
                  radial-gradient(1000px 650px at 90% 10%, rgba(56,217,255,.14), transparent 55%),
                  linear-gradient(160deg, var(--bg1), var(--bg2));
      min-height:100vh;
    }
    a{ color:inherit; }
    .wrap{
      max-width:1100px;
      margin:0 auto;
      padding:28px 18px 42px;
    }
    header{
      display:flex;
      gap:16px;
      align-items:flex-start;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:18px;
    }
    .title{
      display:flex; gap:14px; align-items:center;
    }
    .badge{
      width:52px; height:52px; border-radius:16px;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(56,217,255,.85));
      display:grid; place-items:center;
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,.18);
    }
    .badge span{
      font-family:var(--mono);
      font-weight:800;
      font-size:16px;
      letter-spacing:.5px;
    }
    h1{
      margin:0;
      font-size:22px;
      letter-spacing:.2px;
    }
    .sub{
      margin:6px 0 0;
      color:var(--muted);
      font-size:13.5px;
      line-height:1.4;
      max-width:720px;
    }

    .top-actions{
      display:flex;
      gap:10px;
      align-items:center;
    }
    button{
      appearance:none;
      border:1px solid var(--stroke);
      background: rgba(255,255,255,.06);
      color:var(--text);
      border-radius:14px;
      padding:10px 12px;
      cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      font-weight:650;
      letter-spacing:.2px;
    }
    button:hover{ background: rgba(255,255,255,.09); border-color: rgba(255,255,255,.18); }
    button:active{ transform: translateY(1px) scale(.99); }
    button.primary{
      border-color: rgba(124,92,255,.45);
      background: linear-gradient(135deg, rgba(124,92,255,.92), rgba(56,217,255,.72));
      color:#071226;
      box-shadow: 0 12px 30px rgba(124,92,255,.25);
    }
    button.primary:hover{ filter:brightness(1.03); }
    button.ghost{
      background: transparent;
    }

    .grid{
      display:grid;
      grid-template-columns: 1.2fr .8fr;
      gap:16px;
      align-items:start;
    }
    @media (max-width: 920px){
      .grid{ grid-template-columns:1fr; }
    }

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .panel{
      padding:18px 18px 16px;
    }
    .panel h2{
      margin:0 0 10px;
      font-size:16px;
      color:rgba(255,255,255,.86);
      letter-spacing:.2px;
    }

    .progress{
      padding:16px 18px;
      border-top:1px solid var(--stroke);
      background: rgba(0,0,0,.12);
      display:flex; gap:12px; align-items:center; justify-content:space-between;
    }
    .bar{
      flex:1;
      height:10px;
      border-radius:999px;
      background: rgba(255,255,255,.10);
      overflow:hidden;
      border:1px solid rgba(255,255,255,.10);
    }
    .bar > div{
      height:100%;
      width:0%;
      border-radius:999px;
      background: linear-gradient(90deg, rgba(124,92,255,.95), rgba(56,217,255,.85));
      transition: width .35s ease;
    }
    .step{
      font-family:var(--mono);
      color:rgba(255,255,255,.70);
      font-size:12px;
      white-space:nowrap;
    }

    .qmeta{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      margin-bottom:8px;
    }
    .pill{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color:rgba(255,255,255,.80);
      font-size:12px;
    }
    .pill b{
      color:rgba(255,255,255,.92);
      font-family:var(--mono);
      font-weight:800;
    }

    .question{
      margin:8px 0 12px;
      font-size:18px;
      line-height:1.42;
      letter-spacing:.2px;
    }
    .choices{
      display:grid;
      gap:10px;
      margin-top:10px;
    }
    .choice{
      display:flex;
      gap:12px;
      align-items:flex-start;
      padding:12px 12px;
      border-radius: var(--radius2);
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      cursor:pointer;
      transition: background .18s ease, transform .08s ease, border-color .18s ease;
      position:relative;
      overflow:hidden;
    }
    .choice:hover{
      background: rgba(255,255,255,.09);
      border-color: rgba(255,255,255,.20);
    }
    .choice:active{ transform: translateY(1px); }
    .dot{
      width:18px; height:18px;
      border-radius:50%;
      border:2px solid rgba(255,255,255,.30);
      margin-top:2px;
      flex:0 0 18px;
      display:grid; place-items:center;
    }
    .dot::after{
      content:"";
      width:10px; height:10px;
      border-radius:50%;
      background: transparent;
      transition: background .16s ease;
    }
    .choice.selected{
      border-color: rgba(56,217,255,.55);
      background: rgba(56,217,255,.10);
    }
    .choice.selected .dot{
      border-color: rgba(56,217,255,.75);
    }
    .choice.selected .dot::after{
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(56,217,255,.85));
    }
    .choice .text{
      color:rgba(255,255,255,.90);
      font-size:14.5px;
      line-height:1.45;
    }
    .choice .hint{
      display:block;
      color:rgba(255,255,255,.62);
      font-size:12.5px;
      margin-top:4px;
    }

    .nav{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      margin-top:14px;
    }
    .nav .left{ display:flex; gap:10px; }
    .tiny{
      font-size:12.5px;
      color:rgba(255,255,255,.68);
    }

    /* Sidebar role cards */
    .side{
      padding:18px;
    }
    .side h3{
      margin:0 0 10px;
      font-size:14px;
      color:rgba(255,255,255,.80);
      letter-spacing:.2px;
    }
    .roles{
      display:grid;
      gap:10px;
    }
    .role{
      border:1px solid rgba(255,255,255,.12);
      background: rgba(255,255,255,.05);
      border-radius: 18px;
      padding:12px;
      display:flex;
      gap:10px;
      align-items:flex-start;
      transition: border-color .2s ease, background .2s ease, transform .08s ease;
    }
    .role:hover{
      background: rgba(255,255,255,.07);
      border-color: rgba(255,255,255,.18);
    }
    .role strong{
      display:block;
      font-size:13.5px;
      margin-bottom:4px;
    }
    .role p{
      margin:0;
      font-size:12.5px;
      color:rgba(255,255,255,.66);
      line-height:1.45;
    }
    .sig{
      width:36px; height:36px;
      border-radius:14px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.18);
      display:grid; place-items:center;
      font-family:var(--mono);
      font-weight:800;
      color:rgba(255,255,255,.76);
      flex:0 0 36px;
    }
    .role.active{
      border-color: rgba(124,92,255,.55);
      background: rgba(124,92,255,.10);
    }
    .role.active .sig{
      border-color: rgba(56,217,255,.55);
      color:#0a1a2f;
      background: linear-gradient(135deg, rgba(124,92,255,.95), rgba(56,217,255,.85));
    }

    /* Result */
    .result{
      padding:18px;
      display:none;
    }
    .result.show{ display:block; }
    .result-grid{
      display:grid;
      grid-template-columns: 1.05fr .95fr;
      gap:14px;
    }
    @media (max-width: 920px){
      .result-grid{ grid-template-columns:1fr; }
    }
    .bigLevel{
      display:flex; gap:14px; align-items:center;
      padding:16px;
      border-radius: 22px;
      border:1px solid rgba(255,255,255,.14);
      background: linear-gradient(180deg, rgba(255,255,255,.07), rgba(255,255,255,.05));
    }
    .lvl{
      width:76px; height:76px;
      border-radius:22px;
      display:grid; place-items:center;
      background: linear-gradient(135deg, rgba(124,92,255,.92), rgba(56,217,255,.72));
      color:#071226;
      border:1px solid rgba(255,255,255,.18);
      box-shadow: 0 18px 40px rgba(124,92,255,.22);
      font-family:var(--mono);
      font-weight:900;
      font-size:18px;
    }
    .bigLevel h4{
      margin:0;
      font-size:16px;
    }
    .bigLevel .desc{
      margin:6px 0 0;
      color:rgba(255,255,255,.70);
      font-size:13.5px;
      line-height:1.45;
    }
    .chips{
      margin-top:10px;
      display:flex;
      flex-wrap:wrap;
      gap:8px;
    }
    .chip{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(0,0,0,.14);
      padding:7px 10px;
      border-radius:999px;
      font-size:12.5px;
      color:rgba(255,255,255,.78);
    }
    .chip b{ color:rgba(255,255,255,.92); font-family:var(--mono); }
    .box{
      border:1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.05);
      border-radius: 22px;
      padding:14px;
    }
    .box h5{
      margin:0 0 8px;
      font-size:13.5px;
      color:rgba(255,255,255,.82);
    }
    .box p{
      margin:0;
      color:rgba(255,255,255,.70);
      font-size:13.5px;
      line-height:1.55;
    }

    .footer-note{
      margin-top:14px;
      color:rgba(255,255,255,.55);
      font-size:12.5px;
      line-height:1.45;
    }

    /* Toast */
    .toast{
      position:fixed;
      left:50%;
      bottom:18px;
      transform:translateX(-50%);
      background: rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.14);
      backdrop-filter: blur(10px);
      padding:10px 12px;
      border-radius: 14px;
      color:rgba(255,255,255,.86);
      font-size:13px;
      display:none;
      box-shadow: var(--shadow);
      max-width:min(560px, calc(100vw - 32px));
    }
    .toast.show{ display:block; animation: pop .18s ease; }
    @keyframes pop{ from{ transform:translateX(-50%) translateY(6px); opacity:.2;} to{transform:translateX(-50%) translateY(0); opacity:1;} }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <div class="badge" aria-hidden="true"><span>Lv?</span></div>
        <div>
          <h1>å‰µæ„ç­‰ç´šæ¸¬é©—ï½œä¸ƒå€‹è§’è‰²çš„é¡å­</h1>
          <p class="sub">
            7 é¡Œã€æ¯é¡Œ 3â€“4 é¸é …ã€‚ä½ ä¸éœ€è¦ã€Œç­”å°ã€â€”â€”åªè¦ç…§è‘—ç›´è¦ºé¸ã€‚æœ€å¾Œæœƒå¾—åˆ°ï¼š<b>å‰µæ„ç­‰ç´š Lv.0â€“Lv.7</b>ã€ä½ çš„å‰µæ„ç‰¹è³ªï¼Œä»¥åŠæœ€é©åˆå¬å–šçš„ AI è§’è‰²ã€‚
          </p>
        </div>
      </div>
      <div class="top-actions">
        <button class="ghost" id="btnRandom" title="å¹«ä½ ç”¨ç›´è¦ºå¿«é€Ÿé¸ä¸€è¼ª">æˆ‘å¾ˆè¿·æƒ˜ï¼Œéš¨æ©Ÿä¸€ä¸‹</button>
        <button class="primary" id="btnStart">é–‹å§‹æ¸¬é©—</button>
      </div>
    </header>

    <div class="grid">
      <!-- Main -->
      <section class="card" aria-label="æ¸¬é©—ä¸»å€">
        <div class="panel" id="quizPanel">
          <div class="qmeta">
            <span class="pill">ç›®å‰è§’è‰²ï¼š<b id="roleNow">â€”</b></span>
            <span class="pill">æç¤ºï¼š<b id="roleHint">â€”</b></span>
          </div>

          <div class="question" id="qText">æŒ‰ã€Œé–‹å§‹æ¸¬é©—ã€å¾Œï¼Œé¡Œç›®æœƒå‡ºç¾åœ¨é€™è£¡ã€‚</div>

          <div class="choices" id="choices" aria-live="polite"></div>

          <div class="nav">
            <div class="left">
              <button id="btnPrev">ä¸Šä¸€é¡Œ</button>
              <button id="btnNext" class="primary">ä¸‹ä¸€é¡Œ</button>
            </div>
            <div class="tiny" id="tinyStatus">â€”</div>
          </div>
        </div>

        <div class="progress" aria-label="é€²åº¦">
          <div class="bar" aria-hidden="true"><div id="barFill"></div></div>
          <div class="step"><span id="stepText">0 / 7</span></div>
        </div>

        <!-- Result -->
        <div class="result" id="resultPanel" aria-label="çµæœ">
          <div class="result-grid">
            <div class="bigLevel">
              <div class="lvl" id="lvlBox">Lv.0</div>
              <div>
                <h4 id="lvlTitle">ä½ çš„å‰µæ„ç­‰ç´šï¼šLv.0</h4>
                <p class="desc" id="lvlDesc">â€”</p>
                <div class="chips" id="chips"></div>
              </div>
            </div>

            <div class="box">
              <h5>å»ºè­°å¬å–šè§’è‰²</h5>
              <p id="summon">â€”</p>
              <div style="height:10px"></div>
              <h5>ä¸€å¥çµ¦ä½ çš„è©±</h5>
              <p id="line">â€”</p>
            </div>

            <div class="box" style="grid-column: 1 / -1;">
              <h5>ä½ çš„å‰µæ„ç‰¹è³ªï¼ˆæ‘˜è¦ï¼‰</h5>
              <p id="trait">â€”</p>
              <p class="footer-note">
                å°æé†’ï¼šé€™ä¸æ˜¯å¿ƒç†æ¸¬é©—è¨ºæ–·ï¼Œåªæ˜¯ä¸€å€‹ã€ŒæŠŠä½ æ­¤åˆ»çš„å‰µä½œç¿’æ…£ç¿»è­¯æˆèªè¨€ã€çš„å°å„€å¼ã€‚
              </p>
              <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
                <button id="btnRestart">é‡æ–°æ¸¬ä¸€æ¬¡</button>
                <button id="btnReview" class="ghost">å›çœ‹æˆ‘é¸äº†ä»€éº¼</button>
                <button id="btnCopy" class="primary">è¤‡è£½çµæœæ–‡å­—</button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Sidebar -->
      <aside class="card" aria-label="ä¸ƒå€‹è§’è‰²å¡ç‰‡">
        <div class="side">
          <h3>ä¸ƒå€‹ AI è§’è‰²ï¼ˆæ¯é¡Œå°æ‡‰ä¸€ä½ï¼‰</h3>
          <div class="roles" id="roleList"></div>
          <div style="height:10px"></div>
          <div class="tiny">
            ğŸ’¡ ç©æ³•ï¼šä½ æœƒä¾åºèµ°é 7 å€‹è§’è‰²çš„è¦–è§’ã€‚ä½ ä¸éœ€è¦è®Šæˆä»–å€‘ï¼Œä½ åªæ˜¯åœ¨å€Ÿä»–å€‘çš„çœ¼ç›çœ‹è‡ªå·±ã€‚
          </div>
        </div>
      </aside>
    </div>
  </div>

  <div class="toast" id="toast"></div>

<script>
/**
 * å–®æª” Appï¼šå‰µæ„ç­‰ç´šæ¸¬é©—
 * Lv.0â€“Lv.7ï¼š7 é¡ŒåŠ ç¸½ 0â€“7 åˆ†
 * å¦å¤–çµ±è¨ˆå„ã€Œå‰µæ„å‘åº¦ã€tagï¼Œä¾†ç”Ÿæˆç‰¹è³ªèˆ‡æ¨è–¦å¬å–šè§’è‰²
 */

const ROLES = [
  {
    id:"time",
    name:"æ™‚é–“é­”æ³•å¸«",
    sig:"T",
    hint:"ç¯€å¥ / åœé “ / é€Ÿåº¦æ„Ÿ",
    desc:"æ“…é•·ç”¨ã€Œå¿«èˆ‡æ…¢ã€å¡‘å½¢ï¼Œè®“ä½œå“æœ‰å‘¼å¸ã€‚",
    tag:"time"
  },
  {
    id:"poet",
    name:"è©©äººå·¥ç¨‹å¸«",
    sig:"P",
    hint:"çµæ§‹ / æ¯”ä¾‹ / å„ªé›…",
    desc:"ç›¸ä¿¡ç¾æ„Ÿå¯ä»¥è¢«è¨­è¨ˆï¼Œæ“…é•·æŠŠæ··äº‚æ•´ç†æˆéŸ»å¾‹ã€‚",
    tag:"structure"
  },
  {
    id:"physics",
    name:"ç˜‹ç‹‚ç‰©ç†å®¶",
    sig:"Î¦",
    hint:"è¦å¾‹ / å¯¦é©— / æ¨æ¼”",
    desc:"é‡åˆ°ä»»ä½•ç¾è±¡éƒ½æƒ³ç®—ä¸€ç®—ï¼šé‡åŠ›ã€æ‘©æ“¦ã€è§’åº¦ã€èª¤å·®ã€‚",
    tag:"physics"
  },
  {
    id:"chaos",
    name:"æ··äº‚ç¾å­¸å®¶",
    sig:"C",
    hint:"æ„å¤– / ç ´æ ¼ / é©šå–œ",
    desc:"è¦ºå¾—æœ€ç¾çš„ç¬é–“å¸¸ä¾†è‡ªå¤±æ§ï¼Œæ“…é•·æŠŠäº‹æ•…è®Šäº®é»ã€‚",
    tag:"chaos"
  },
  {
    id:"game",
    name:"ç©æ¨‚éŠæˆ²å¤§å¸«",
    sig:"G",
    hint:"äº’å‹• / é«”é©— / çˆ½æ„Ÿ",
    desc:"æŠŠä¸€åˆ‡éƒ½ç•¶æˆé—œå¡è¨­è¨ˆï¼šç©å®¶æ„Ÿå—æœ€é‡è¦ã€‚",
    tag:"play"
  },
  {
    id:"alien",
    name:"å¤–æ˜Ÿçƒé“å…·å°ˆå®¶",
    sig:"A",
    hint:"é™Œç”ŸåŒ– / è¦–è§’ç¿»è½‰",
    desc:"ä¾†è‡ªä¸åŒé‡åŠ›çš„æƒ³åƒï¼Œæœ€æ„›è³ªç–‘æˆ‘å€‘çš„ã€Œå¸¸è­˜ã€ã€‚",
    tag:"novelty"
  },
  {
    id:"minimal",
    name:"æ¥µç°¡å“²å­¸å®¶",
    sig:"M",
    hint:"åˆªå» / ç•™ç™½ / æœ¬è³ª",
    desc:"è¿½æ±‚ã€å°‘å³æ˜¯å¤šã€ï¼šç”¨æœ€å°‘å…ƒç´ èªªæœ€å¤§ä»¶äº‹ã€‚",
    tag:"minimal"
  }
];

// 7é¡Œï¼Œæ¯é¡Œå°æ‡‰ä¸€ä½è§’è‰²ï¼›æ¯é¡Œé¸é …çµ¦åˆ† 0â€“1ï¼ˆç¸½åˆ†0â€“7ï¼‰
// ä¸¦çµ¦ tags åˆ†æ•¸ï¼ˆç”¨ä¾†åˆ†æç‰¹è³ª & æ¨è–¦å¬å–šè§’è‰²ï¼‰
const QUESTIONS = [
  {
    roleId:"time",
    q:"å¦‚æœä½ çš„ä½œå“æ˜¯ä¸€æ®µè·¯ï¼Œä½ æœ€åœ¨æ„çš„æ˜¯å“ªå€‹ç¬é–“ï¼Ÿ",
    choices:[
      {t:"çƒï¼ˆæˆ–è¦–ç·šï¼‰çªç„¶åŠ é€Ÿçš„é‚£ä¸€ä¸‹", hint:"å¿«æ˜¯åŠ›é‡ï¼Œä¹Ÿæ˜¯ä¸€ç¨®å‹‡æ°£ã€‚", pts:1, tags:{time:2, play:1}},
      {t:"åœä½ã€å¡ä½ã€å·®é»éä¸å»çš„é‚£ä¸€ç§’", hint:"ä½ é¡˜æ„æŠŠè„†å¼±ç•™ä¸‹ä¾†ã€‚", pts:1, tags:{time:2, minimal:1}},
      {t:"æ•´æ®µéƒ½å¹³å‡é †é †èµ°å®Œï¼Œä¸è¦å‡ºäº‹", hint:"å®‰å…¨æ„Ÿå…ˆï¼Œå‰µæ„æ…¢æ…¢ä¾†ã€‚", pts:0, tags:{structure:1, physics:1}},
      {t:"æˆ‘å…¶å¯¦ä¸ç¢ºå®šï¼Œæˆ‘åªæƒ³å…ˆçœ‹åˆ¥äººæ€éº¼åš", hint:"è§€å¯Ÿä¹Ÿæ˜¯å‰µä½œçš„ä¸€éƒ¨åˆ†ã€‚", pts:0, tags:{novelty:1}}
    ]
  },
  {
    roleId:"poet",
    q:"ç•¶ä½ è¦æŠŠæƒ³æ³•åšæˆã€çœ‹å¾—æ‡‚ã€çš„å½¢å¼ï¼Œä½ é€šå¸¸æ€éº¼é–‹å§‹ï¼Ÿ",
    choices:[
      {t:"å…ˆç•«è‰åœ–ï¼ŒæŠŠæ¯”ä¾‹ã€ä½ç½®å…ˆå®šä¸‹ä¾†", hint:"ä½ åœ¨æ‰¾ä¸€å€‹å„ªé›…çš„éª¨æ¶ã€‚", pts:1, tags:{structure:2, minimal:1}},
      {t:"å…ˆå¯«ä¸€å¥è©±ï¼Œè®“ä½œå“æœ‰æ ¸å¿ƒèªæ°£", hint:"ä½ ç”¨èªè¨€å®šä½æƒ…ç·’ã€‚", pts:1, tags:{structure:1, time:1}},
      {t:"å…ˆåšä¸€å€‹å°æ¨£ï¼Œé‚Šåšé‚Šä¿®", hint:"ä½ ç›¸ä¿¡æ‰‹æ„Ÿæœƒå¸¶è·¯ã€‚", pts:1, tags:{play:1, chaos:1}},
      {t:"æˆ‘æœƒæ‹–åˆ°å¾ˆå¾Œé¢æ‰é–‹å§‹", hint:"ä½ éœ€è¦æ›´å¤§çš„å®‰å…¨æ„Ÿæ‰æ•¢å‹•æ‰‹ã€‚", pts:0, tags:{minimal:1}}
    ]
  },
  {
    roleId:"physics",
    q:"é‡åˆ°çƒæ»¾ä¸å‹• / çµæ§‹ä¸ç©©ï¼Œä½ ç¬¬ä¸€åæ‡‰æ˜¯ï¼Ÿ",
    choices:[
      {t:"èª¿è§’åº¦ã€æ‘©æ“¦ã€é‡é‡ï¼Œä¸€æ¬¡åªæ”¹ä¸€å€‹è®Šå› ", hint:"ä½ å¤©ç”Ÿæ˜¯å¯¦é©—æ´¾ã€‚", pts:1, tags:{physics:2, structure:1}},
      {t:"å…ˆæš´åŠ›é‡åšï¼Œåæ­£é‡ä¾†æ¯”è¼ƒå¿«", hint:"ä½ ç›¸ä¿¡è¡Œå‹•èƒ½è§£æ±ºç„¦æ…®ã€‚", pts:1, tags:{play:1, chaos:1}},
      {t:"å…ˆå•åŒå­¸ï¼šä½ é‚£é‚Šæ€éº¼è§£ï¼Ÿ", hint:"ä½ æ“…é•·æŠŠå”ä½œç•¶æ·å¾‘ã€‚", pts:1, tags:{play:1, novelty:1}},
      {t:"å…ˆæ€ªè‡ªå·±ï¼šæ˜¯ä¸æ˜¯æˆ‘ä¸é©åˆåšé€™å€‹ï¼Ÿ", hint:"ä½ å¾ˆåœ¨æ„ã€æˆ‘å¤ ä¸å¤ å¥½ã€ã€‚", pts:0, tags:{minimal:1}}
    ]
  },
  {
    roleId:"chaos",
    q:"ä½œå“å‡ºç¾ã€æ„å¤–ã€ï¼šæ­ªäº†ã€çšºäº†ã€é»éŒ¯äº†â€¦ä½ æ›´å¯èƒ½ï¼Ÿ",
    choices:[
      {t:"ç•™ä¸‹å®ƒï¼Œè®“æ„å¤–è®Šæˆæ•…äº‹çš„ä¸€éƒ¨åˆ†", hint:"ä½ æœ‰æŠŠå¤±æ§è®Šé­…åŠ›çš„å¤©è³¦ã€‚", pts:1, tags:{chaos:2, novelty:1}},
      {t:"ç«‹åˆ»ä¿®åˆ°çœ‹ä¸å‡ºä¾†ï¼Œè¶Šä¹¾æ·¨è¶Šå¥½", hint:"ä½ è¿½æ±‚æŒæ§èˆ‡å®Œæˆåº¦ã€‚", pts:1, tags:{structure:2}},
      {t:"æ‹ç…§å­˜è­‰ï¼Œå›å»åˆ†æåŸå› ", hint:"ä½ æŠŠæƒ…ç·’å…ˆæ”¶èµ·ä¾†åšç ”ç©¶ã€‚", pts:1, tags:{physics:2}},
      {t:"æˆ‘æœƒå¡ä½å¾ˆä¹…ï¼Œä¸çŸ¥é“è¦ä¸è¦é‡ä¾†", hint:"ä½ åœ¨æ„æ¯ä¸€æ­¥æ˜¯ä¸æ˜¯æ­£ç¢ºã€‚", pts:0, tags:{time:1}}
    ]
  },
  {
    roleId:"game",
    q:"å¦‚æœè¦è®“åˆ¥äººã€æƒ³ç©ã€ä½ çš„ä½œå“ï¼Œä½ æœ€æƒ³åŠ ä»€éº¼ï¼Ÿ",
    choices:[
      {t:"æ˜ç¢ºç›®æ¨™ï¼‹å›é¥‹ï¼ˆæˆåŠŸ/å¤±æ•—ã€åˆ†æ•¸ã€éŸ³æ•ˆï¼‰", hint:"ä½ è¶…æ‡‚äº’å‹•çš„çˆ½æ„Ÿã€‚", pts:1, tags:{play:2, structure:1}},
      {t:"å½©è›‹èˆ‡é©šå–œï¼ˆèµ°åˆ°æŸè™•æœƒçªç„¶è®ŠåŒ–ï¼‰", hint:"ä½ æœƒè®“äººå¿ä¸ä½å†è©¦ä¸€æ¬¡ã€‚", pts:1, tags:{play:1, chaos:1}},
      {t:"å¾ˆç›´è¦ºçš„å°å¼•ï¼Œä¸ç”¨èªªæ˜ä¹Ÿæœƒ", hint:"ä½ é‡è¦–ä½¿ç”¨è€…é«”é©—ã€‚", pts:1, tags:{minimal:1, play:1}},
      {t:"æˆ‘ä¸å¤ªæƒ³è®“åˆ¥äººç¢°ï¼Œæˆ‘æƒ³å®ƒå®‰éœè¢«çœ‹è¦‹", hint:"ä½ åœ¨æ‰¾è‡ªå·±çš„æ­¥èª¿ã€‚", pts:0, tags:{minimal:2}}
    ]
  },
  {
    roleId:"alien",
    q:"å¦‚æœå¤–æ˜Ÿäººä¾†çœ‹ä½ çš„ä½œå“ï¼Œä»–æœƒè¦ºå¾—æœ€ã€å¥‡æ€ªåˆæœ‰è¶£ã€çš„æ˜¯ï¼Ÿ",
    choices:[
      {t:"æˆ‘å€‘å±…ç„¶ç›¸ä¿¡ã€é‡åŠ›ä¸€å®šå¾€ä¸‹ã€", hint:"ä½ æ“…é•·ç¿»è½‰å¸¸è­˜ã€‚", pts:1, tags:{novelty:2, physics:1}},
      {t:"æˆ‘å€‘ç”¨ç´™ã€è† å¸¶åšä¸–ç•Œï¼Œå»å¾ˆèªçœŸ", hint:"ä½ çœ‹å¾—è¦‹ææ–™çš„è©©æ„ã€‚", pts:1, tags:{structure:1, poet:1, novelty:1}},
      {t:"æˆ‘å€‘ä¸€ç›´æƒ³è¦ã€å®Œç¾ã€ï¼Œä½†å…¶å¯¦æœ€ç¾åœ¨è£‚ç¸«", hint:"ä½ æ•æ„Ÿä¸”èª å¯¦ã€‚", pts:1, tags:{chaos:1, time:1, novelty:1}},
      {t:"æˆ‘ä¸çŸ¥é“ï¼Œæˆ‘åªæƒ³è¶•å¿«äº¤ä½œæ¥­", hint:"ä½ ç¾åœ¨éœ€è¦çš„æ˜¯å–˜å£æ°£ã€‚", pts:0, tags:{minimal:1}}
    ]
  },
  {
    roleId:"minimal",
    q:"æœ€å¾Œæ”¶å°¾æ™‚ï¼Œä½ æ›´æƒ³åšå“ªä¸€ç¨®é¸æ“‡ï¼Ÿ",
    choices:[
      {t:"åˆªæ‰ 30% çš„è£é£¾ï¼Œåªç•™ä¸‹æœ€å¿…è¦çš„ç·šç´¢", hint:"ä½ ç›¸ä¿¡ç•™ç™½æœƒèªªè©±ã€‚", pts:1, tags:{minimal:2, structure:1}},
      {t:"åŠ ä¸€å€‹é—œéµäº®é»ï¼ˆç‡ˆå…‰/å¾½ç« /è²éŸ³ï¼‰è®“å®ƒè¢«è¨˜å¾—", hint:"ä½ æƒ³è®“ä½œå“æœ‰ä¸€å€‹ã€è¨˜æ†¶é»ã€ã€‚", pts:1, tags:{time:1, play:1}},
      {t:"æŠŠå®ƒåšæ›´å¤§ã€æ›´æ»¿ã€æ›´è¤‡é›œ", hint:"ä½ ç”¨èƒ½é‡æ¨å‹•å‰µä½œã€‚", pts:1, tags:{chaos:1, play:1}},
      {t:"ç¶­æŒç¾ç‹€ï¼Œä¸å†å‹•å®ƒï¼Œæ€•è¶Šæ”¹è¶Šç³Ÿ", hint:"ä½ æ­£åœ¨ä¿è­·ç¾åœ¨çš„æˆæœã€‚", pts:0, tags:{structure:1}}
    ]
  }
];

// UI elements
const btnStart = document.getElementById("btnStart");
const btnRandom = document.getElementById("btnRandom");
const btnPrev = document.getElementById("btnPrev");
const btnNext = document.getElementById("btnNext");
const qText = document.getElementById("qText");
const choicesEl = document.getElementById("choices");
const barFill = document.getElementById("barFill");
const stepText = document.getElementById("stepText");
const roleNow = document.getElementById("roleNow");
const roleHint = document.getElementById("roleHint");
const tinyStatus = document.getElementById("tinyStatus");
const roleList = document.getElementById("roleList");

const quizPanel = document.getElementById("quizPanel");
const resultPanel = document.getElementById("resultPanel");

const lvlBox = document.getElementById("lvlBox");
const lvlTitle = document.getElementById("lvlTitle");
const lvlDesc = document.getElementById("lvlDesc");
const chips = document.getElementById("chips");
const trait = document.getElementById("trait");
const summon = document.getElementById("summon");
const line = document.getElementById("line");

const btnRestart = document.getElementById("btnRestart");
const btnReview = document.getElementById("btnReview");
const btnCopy = document.getElementById("btnCopy");

const toast = document.getElementById("toast");

// State
let started = false;
let idx = 0;
let answers = Array(QUESTIONS.length).fill(null); // store choice index
let tagScore = {}; // computed on submit

function showToast(msg){
  toast.textContent = msg;
  toast.classList.add("show");
  clearTimeout(showToast._t);
  showToast._t = setTimeout(()=>toast.classList.remove("show"), 1800);
}

function getRole(roleId){ return ROLES.find(r=>r.id===roleId); }

function renderRoleList(activeRoleId){
  roleList.innerHTML = "";
  ROLES.forEach(r=>{
    const div = document.createElement("div");
    div.className = "role" + (r.id===activeRoleId ? " active" : "");
    div.innerHTML = `
      <div class="sig">${r.sig}</div>
      <div>
        <strong>${r.name}</strong>
        <p>æ“…é•·ï¼š${r.hint}<br><span style="color:rgba(255,255,255,.55)">${r.desc}</span></p>
      </div>
    `;
    roleList.appendChild(div);
  });
}

function progress(){
  const done = answers.filter(v=>v!==null).length;
  stepText.textContent = `${Math.min(idx+1,7)} / 7`;
  barFill.style.width = `${(done/QUESTIONS.length)*100}%`;
  tinyStatus.textContent = done===QUESTIONS.length ? "å·²å®Œæˆå…¨éƒ¨é¡Œç›®ï¼Œå¯ç›´æ¥çœ‹çµæœ" : `å·²å›ç­”ï¼š${done} / ${QUESTIONS.length}`;
}

function renderQuestion(){
  const q = QUESTIONS[idx];
  const role = getRole(q.roleId);
  roleNow.textContent = role.name;
  roleHint.textContent = role.hint;
  renderRoleList(q.roleId);

  qText.textContent = `Q${idx+1}. ${q.q}`;
  choicesEl.innerHTML = "";

  q.choices.forEach((c, ci)=>{
    const d = document.createElement("div");
    d.className = "choice" + (answers[idx]===ci ? " selected" : "");
    d.setAttribute("role","button");
    d.setAttribute("tabindex","0");
    d.innerHTML = `
      <div class="dot" aria-hidden="true"></div>
      <div class="text">
        ${c.t}
        <span class="hint">${c.hint}</span>
      </div>
    `;
    d.addEventListener("click", ()=>selectChoice(ci));
    d.addEventListener("keydown", (e)=>{
      if(e.key==="Enter" || e.key===" "){
        e.preventDefault();
        selectChoice(ci);
      }
    });
    choicesEl.appendChild(d);
  });

  btnPrev.disabled = idx===0;
  btnNext.textContent = (idx===QUESTIONS.length-1) ? "çœ‹çµæœ" : "ä¸‹ä¸€é¡Œ";
  progress();
}

function selectChoice(ci){
  answers[idx] = ci;
  // update selected UI
  [...choicesEl.children].forEach((el,i)=>el.classList.toggle("selected", i===ci));
  progress();
}

function start(){
  started = true;
  idx = 0;
  answers = Array(QUESTIONS.length).fill(null);
  tagScore = {};
  resultPanel.classList.remove("show");
  resultPanel.style.display = "none";
  quizPanel.style.display = "block";
  showToast("ç…§ç›´è¦ºé¸å°±å¥½ã€‚");
  renderQuestion();
}

function next(){
  if(!started){ showToast("å…ˆæŒ‰ã€Œé–‹å§‹æ¸¬é©—ã€"); return; }
  if(answers[idx]===null){
    showToast("é€™é¡Œå…ˆé¸ä¸€å€‹ç­”æ¡ˆï½");
    return;
  }
  if(idx === QUESTIONS.length-1){
    showResult();
    return;
  }
  idx++;
  renderQuestion();
}

function prev(){
  if(!started) return;
  if(idx>0){ idx--; renderQuestion(); }
}

function randomFill(){
  if(!started){
    start();
    // small delay for perceived flow
    setTimeout(()=>randomFill(), 60);
    return;
  }
  for(let i=0;i<QUESTIONS.length;i++){
    const count = QUESTIONS[i].choices.length;
    answers[i] = Math.floor(Math.random()*count);
  }
  idx = QUESTIONS.length-1;
  renderQuestion();
  showToast("å·²ç”¨ç›´è¦ºï¼ˆéš¨æ©Ÿï¼‰é¸å®Œä¸€è¼ªï¼Œå¯ç›´æ¥çœ‹çµæœã€‚");
}

function compute(){
  let score = 0;
  const tags = {
    time:0, structure:0, physics:0, chaos:0, play:0, novelty:0, minimal:0
  };
  for(let i=0;i<QUESTIONS.length;i++){
    const q = QUESTIONS[i];
    const ci = answers[i];
    const choice = q.choices[ci];
    score += choice.pts;
    const t = choice.tags || {};
    Object.keys(t).forEach(k=>{
      if(tags[k]===undefined) tags[k]=0;
      tags[k] += t[k];
    });
  }
  // clamp score 0..7
  score = Math.max(0, Math.min(7, score));
  return {score, tags};
}

function levelCopy(score){
  const map = [
    {t:"Lv.0ï½œé‚„åœ¨é–€å£", d:"ä½ ä¸æ˜¯æ²’å‰µæ„ï¼Œä½ åªæ˜¯é‚„åœ¨æ‰¾å®‰å…¨æ„Ÿã€‚å…ˆå¾ã€ä¸€å€‹å°å‹•ä½œã€é–‹å§‹å°±å¥½ã€‚"},
    {t:"Lv.1ï½œé–‹å§‹é¡˜æ„ç¢°", d:"ä½ é¡˜æ„è©¦ï¼Œä½†é‚„æ€•å‡ºéŒ¯ã€‚æŠŠã€å¤±æ•—ã€æ”¹åå«ã€æ¸¬è©¦ã€æœƒæ›´è¼•é¬†ã€‚"},
    {t:"Lv.2ï½œæœ‰æ„Ÿè¦ºäº†", d:"ä½ é–‹å§‹æŠ“åˆ°è‡ªå·±çš„ç¯€å¥ã€‚åˆ¥æ€¥è‘—æ¼‚äº®ï¼Œå…ˆè®“ä½œå“æ´»è‘—ã€‚"},
    {t:"Lv.3ï½œæœƒè½‰å½", d:"ä½ èƒ½åœ¨å¡ä½æ™‚æƒ³è¾¦æ³•ï¼Œå‰µæ„æ­£åœ¨è®Šæˆä½ çš„å·¥å…·ã€‚"},
    {t:"Lv.4ï½œèƒ½å°è©±", d:"ä½ ä¸åªåšä½œå“ï¼Œä½ åœ¨è·Ÿææ–™ã€æ™‚é–“ã€ä»–äººäº’ç›¸å›æ‡‰ã€‚"},
    {t:"Lv.5ï½œæœ‰é¢¨æ ¼", d:"ä½ é–‹å§‹å½¢æˆè‡ªå·±çš„åå¥½èˆ‡èªæ°£ï¼Œåˆ¥äººæœƒèªå¾—ä½ çš„æ‰‹å‹¢ã€‚"},
    {t:"Lv.6ï½œèƒ½å¸¶å‹•", d:"ä½ èƒ½æŠŠäººæ‹‰é€²ä¾†ä¸€èµ·ç©ã€ä¸€èµ·åšã€‚ä½ çš„å‰µæ„å…·æœ‰æ„ŸæŸ“åŠ›ã€‚"},
    {t:"Lv.7ï½œåƒä¸–ç•Œåœ¨å‘¼å¸", d:"ä½ å·²ç¶“èƒ½è®“ä½œå“æ‰¿è¼‰æƒ…ç·’èˆ‡è§€é»â€”â€”ä¸æ˜¯ç‚«æŠ€ï¼Œè€Œæ˜¯èª å¯¦ã€‚"}
  ];
  return map[score];
}

function topTags(tags){
  // sort by score desc
  return Object.entries(tags)
    .sort((a,b)=>b[1]-a[1])
    .filter(([k,v])=>v>0);
}

function suggestRole(tags){
  // map main tag -> role
  const tagToRoleId = {
    time:"time",
    structure:"poet",
    physics:"physics",
    chaos:"chaos",
    play:"game",
    novelty:"alien",
    minimal:"minimal"
  };
  const tops = topTags(tags);
  const bestTag = tops.length ? tops[0][0] : "minimal";
  const roleId = tagToRoleId[bestTag] || "minimal";
  return getRole(roleId);
}

function buildTrait(tags){
  const tops = topTags(tags).slice(0,3);
  const names = {
    time:"ç¯€å¥æ„Ÿ", structure:"çµæ§‹æ„Ÿ", physics:"æ¨ç†æ„Ÿ", chaos:"æ„å¤–æ„Ÿ", play:"äº’å‹•æ„Ÿ", novelty:"é™Œç”ŸåŒ–", minimal:"ç•™ç™½åŠ›"
  };
  const parts = tops.map(([k,v])=>`ã€Œ${names[k]}ã€`).join("ã€");
  const t0 = tops[0]?.[0] || "minimal";
  const t1 = tops[1]?.[0] || null;

  const sentences = [];
  sentences.push(`ä½ ç›®å‰æœ€å¼·çš„å‰µæ„è‚Œè‚‰æ˜¯ ${parts || "ã€Œç•™ç™½åŠ›ã€"}ã€‚`);

  const flavor = {
    time:"ä½ æœƒç”¨ã€å¿«æ…¢ã€èªªæ•…äº‹ï¼Œæ“…é•·åœ¨è½‰æ›è™•ç•™ä¸‹è¢«è½è¦‹çš„ç¬é–“ã€‚",
    structure:"ä½ æ“…é•·æŠŠæ··äº‚æ”¶æŸæˆå¯è®€çš„å½¢ç‹€ï¼Œè®“äººä¸€çœ¼æ‡‚ä½ åœ¨æ„ä»€éº¼ã€‚",
    physics:"ä½ æœƒç”¨è¦å¾‹å’Œæ¸¬è©¦ä¿è­·è‡ªå·±ï¼Œä¹Ÿè®“ä½œå“è¶Šä¾†è¶Šå¯é ã€‚",
    chaos:"ä½ é¡˜æ„æŠŠæ„å¤–ç•™ä¸‹ä¾†ï¼Œä¸¦æŠŠå®ƒè®Šæˆã€åªæœ‰ä½ åšå¾—åˆ°ã€çš„äº®é»ã€‚",
    play:"ä½ å¤©ç”Ÿåœ¨æƒ³ã€è§€çœ¾æ€éº¼æ„Ÿè¦ºã€ï¼Œä½ çš„ä½œå“å¾ˆå®¹æ˜“è®“äººæƒ³åƒèˆ‡ã€‚",
    novelty:"ä½ æ“…é•·æŠŠç†Ÿæ‚‰çš„äº‹è®Šé™Œç”Ÿï¼Œè®“ä¸–ç•Œé‡æ–°è®Šæœ‰è¶£ã€‚",
    minimal:"ä½ åœ¨å­¸æœƒåˆªæ¸›èˆ‡ç•™ç™½ï¼šä¸æ˜¯å°‘åšï¼Œè€Œæ˜¯æ›´ç²¾æº–åœ°ç•™ä¸‹ã€‚"
  };
  sentences.push(flavor[t0] || flavor.minimal);

  if(t1 && t1!==t0){
    const combo = {
      "structure+play":"ä½ åŒæ™‚åœ¨æ„ã€å¥½æ‡‚ã€èˆ‡ã€å¥½ç©ã€ï¼Œå¾ˆé©åˆåšäº’å‹•é«”é©—è¨­è¨ˆã€‚",
      "physics+time":"ä½ æœƒæŠŠç¯€å¥æ‹†æˆå¯æ¸¬é‡çš„æ±è¥¿ï¼Œé©åˆåšè²éŸ³/é‹å‹•çš„ç³»çµ±åŒ–è¡¨é”ã€‚",
      "chaos+structure":"ä½ èƒ½åœ¨å¤±æ§ä¸­æ‰¾å‡ºç§©åºï¼Œåšå‡ºã€çœ‹ä¼¼äº‚ï¼Œå…¶å¯¦å¾ˆæº–ã€çš„ç¾ã€‚",
      "minimal+time":"ä½ é åœé “èˆ‡ç•™ç™½è£½é€ å¼µåŠ›ï¼Œä½œå“å®¹æ˜“æœ‰é¤˜éŸ»ã€‚",
      "novelty+play":"ä½ æ“…é•·ç”¨åå·®èˆ‡é©šå–œè®“äººä¸Šé‰¤ï¼Œç‰¹åˆ¥é©åˆåšå½©è›‹èˆ‡åŠ‡æƒ…äº’å‹•ã€‚"
    };
    const key = `${t0}+${t1}`;
    const key2 = `${t1}+${t0}`;
    sentences.push(combo[key] || combo[key2] || `ç¬¬äºŒå¼·çš„å‘åº¦è®“ä½ åœ¨ã€Œ${(t1)}ã€ä¸Šæ›´å®¹æ˜“çˆ†ç™¼ã€‚`);
  }

  return sentences.join(" ");
}

function buildChips(tags){
  const names = {
    time:"ç¯€å¥", structure:"çµæ§‹", physics:"æ¨ç†", chaos:"æ„å¤–", play:"äº’å‹•", novelty:"é™Œç”ŸåŒ–", minimal:"ç•™ç™½"
  };
  chips.innerHTML = "";
  const tops = topTags(tags).slice(0,4);
  tops.forEach(([k,v])=>{
    const span = document.createElement("span");
    span.className = "chip";
    span.innerHTML = `${names[k]} <b>${v}</b>`;
    chips.appendChild(span);
  });
  if(!tops.length){
    const span = document.createElement("span");
    span.className="chip";
    span.textContent="ï¼ˆé‚„æ²’æ¸¬åˆ°æ˜é¡¯åå¥½ï¼‰";
    chips.appendChild(span);
  }
}

function buildSummonText(role){
  const msg = [
    `æˆ‘å»ºè­°ä½ å¬å–šã€Œ${role.name}ã€ã€‚`,
    `å› ç‚ºä½ åœ¨é¸æ“‡è£¡ä¸€ç›´åœ¨è¿½ï¼š${role.hint}ã€‚`,
    `ç•¶ä½ å¡ä½æ™‚ï¼Œè©¦è‘—ç”¨ä»–çš„å£å»å•ä¸€å¥ï¼šã€Œ${rolePrompt(role.id)}ã€`
  ].join(" ");
  return msg;
}

function rolePrompt(roleId){
  const prompts = {
    time:"é€™è£¡éœ€è¦æ…¢ä¸€é»ï¼Œé‚„æ˜¯å¿«ä¸€é»ï¼Ÿæˆ‘æƒ³è®“äººåœ¨å“ªè£¡å‘¼å¸ï¼Ÿ",
    poet:"å¦‚æœåªç•™ä¸€å€‹ç•«é¢ï¼Œæˆ‘è¦ç•™ä¸‹å“ªå€‹æ¯”ä¾‹èˆ‡ç¯€å¥ï¼Ÿ",
    physics:"å“ªå€‹è®Šå› æœ€é—œéµï¼Ÿæˆ‘èƒ½ä¸èƒ½åšä¸€å€‹å°å¯¦é©—é©—è­‰ï¼Ÿ",
    chaos:"æˆ‘èƒ½ä¸èƒ½æŠŠé€™å€‹å¤±èª¤è®Šæˆäº®é»ï¼Ÿè®“æ„å¤–èªªè©±ï¼Ÿ",
    game:"ç©å®¶åœ¨é€™è£¡æœƒæœ‰ä»€éº¼æ„Ÿè¦ºï¼Ÿæˆ‘èƒ½çµ¦ä»–ä»€éº¼å›é¥‹ï¼Ÿ",
    alien:"ç‚ºä»€éº¼æˆ‘å€‘åªé€™æ¨£æƒ³ï¼Ÿå¦‚æœé‡åŠ›ç›¸åæœƒæ€æ¨£ï¼Ÿ",
    minimal:"æˆ‘å¯ä»¥åˆªæ‰å“ªäº›å¤šé¤˜çš„ï¼Ÿä»€éº¼æ‰æ˜¯çœŸæ­£å¿…è¦ï¼Ÿ"
  };
  return prompts[roleId] || prompts.minimal;
}

function oneLiner(score){
  const lines = [
    "ä½ ä¸ç”¨æº–å‚™å¥½æ‰é–‹å§‹ï¼Œä½ é–‹å§‹äº†æ‰æœƒæº–å‚™å¥½ã€‚",
    "å‰µæ„ä¸æ˜¯éˆæ„Ÿï¼Œæ˜¯ä½ é¡˜æ„ç•™ä¸‹ä¾†çš„é‚£ä¸€ç§’ã€‚",
    "ä½ ä¸æ˜¯ä¸å¤ å¥½ï¼Œä½ åªæ˜¯é‚„åœ¨æ‰¾è‡ªå·±çš„èªæ°£ã€‚",
    "æŠŠã€å¤±æ•—ã€æ”¹åå«ã€æ¸¬è©¦ã€ï¼Œä½ æœƒè¼•å¾ˆå¤šã€‚",
    "æœ‰äº›ä½œå“ä¸æ˜¯è¦è¢«çœ‹åˆ°ï¼Œæ˜¯è¦è¢«è½è¦‹ã€‚",
    "ä¸çªå‡ºï¼Œä¹Ÿä¸ç­‰æ–¼ä¸å­˜åœ¨ã€‚",
    "ä¸–ç•Œæœƒè¨˜å¾—ä½ æœ€èª å¯¦çš„é‚£å€‹ç¬é–“ã€‚",
    "ä½ å·²ç¶“èƒ½è®“ä¸–ç•Œäº’ç›¸ç…§äº®äº†ã€‚"
  ];
  return lines[Math.min(7, Math.max(0, score))];
}

function showResult(){
  // ensure all answered
  const done = answers.every(v=>v!==null);
  if(!done){
    showToast("é‚„æœ‰é¡Œç›®æ²’é¸å®Œå–”ï½");
    return;
  }

  const {score, tags} = compute();
  tagScore = tags;

  const {t, d} = levelCopy(score);
  lvlBox.textContent = `Lv.${score}`;
  lvlTitle.textContent = `ä½ çš„å‰µæ„ç­‰ç´šï¼šLv.${score}`;
  lvlDesc.textContent = d;

  buildChips(tags);

  const r = suggestRole(tags);
  trait.textContent = buildTrait(tags);
  summon.textContent = buildSummonText(r);
  line.textContent = oneLiner(score);

  quizPanel.style.display = "none";
  resultPanel.style.display = "block";
  resultPanel.classList.add("show");
  barFill.style.width = "100%";
  stepText.textContent = "7 / 7";
}

function restart(){
  start();
}

function review(){
  // back to quiz view, go to Q1 and keep answers
  quizPanel.style.display = "block";
  resultPanel.style.display = "none";
  resultPanel.classList.remove("show");
  idx = 0;
  renderQuestion();
  showToast("å›åˆ°é¡Œç›®ï¼Œå·¦å³åˆ‡æ›å¯ä»¥çœ‹ä½ çš„é¸æ“‡ã€‚");
}

function copyResult(){
  const {score, tags} = compute();
  const r = suggestRole(tags);
  const top = topTags(tags).slice(0,3).map(([k,v])=>`${k}:${v}`).join(", ");
  const text =
`ã€å‰µæ„ç­‰ç´šæ¸¬é©—çµæœã€‘
ç­‰ç´šï¼šLv.${score}
ç‰¹è³ªï¼š${buildTrait(tags)}
å»ºè­°å¬å–šï¼š${r.name}ï¼ˆæ“…é•·ï¼š${r.hint}ï¼‰
ä¸€å¥è©±ï¼š${oneLiner(score)}
å‘åº¦åˆ†æ•¸ï¼š${top}`;
  navigator.clipboard.writeText(text).then(()=>{
    showToast("å·²è¤‡è£½ï¼å¯ä»¥è²¼åˆ°ä½ çš„å¤šåª’é«”å°èªª/å°åº•ã€‚");
  }).catch(()=>{
    showToast("è¤‡è£½å¤±æ•—ï¼šä½ çš„ç€è¦½å™¨å¯èƒ½ä¸å…è¨±å‰ªè²¼ç°¿ã€‚");
  });
}

// Wire buttons
btnStart.addEventListener("click", start);
btnRandom.addEventListener("click", randomFill);
btnPrev.addEventListener("click", prev);
btnNext.addEventListener("click", next);
btnRestart.addEventListener("click", restart);
btnReview.addEventListener("click", review);
btnCopy.addEventListener("click", copyResult);

// Initial render (role list only)
renderRoleList(null);
progress();
</script>
</body>
</html>
